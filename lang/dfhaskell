# -*- mode: dockerfile -*-
# Haskell dockerfile
#
# This dockerfile creates the haskell image. It derives from the base.
#
# Author: arvindd
# Created: 03.May.2021
#
# Copyright (c) 2021 Arvind Devarajan
# Licensed to you under the MIT License.
# See the LICENSE file in the project root for more information.
#
FROM ramdootin/devlab:base-v1

USER root 

# Install ca certificates from curl's site itself, and also all dependencies
RUN wget http://curl.haxx.se/ca/cacert.pem -O /etc/pki/trust/anchors/cacert.pem && \
    update-ca-certificates && zypper -n install gcc-c++ gcc gmp-devel make ncurses-devel 

# Update path to include ghcup binaries
RUN echo "pupdate ~/.ghcup/bin" >> /etc/zsh.zshrc.local

USER dev
WORKDIR /home/dev

# Create these variables so that programs running inside the containers know
# what language they can make use of.
ENV DEVLABLANG=${LANG}
ENV DEVLABVER=${VER}

# Install GHCUP non-interactively (for cabal users)
ENV BOOTSTRAP_HASKELL_NONINTERACTIVE=1
ENV BOOTSTRAP_HASKELL_GHC_VERSION=${DEVLABVER}
RUN curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org | sh

# Install haskell stack and its components
RUN sudo zsh -c "curl -sSL https://get.haskellstack.org/ | sh"
